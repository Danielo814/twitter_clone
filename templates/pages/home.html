{% extends 'base.html' %} 

{% block content %} 
<div class="row text-center">
  <div class="col">
    <h1>Welcome to Tweetme</h1>

  </div>
</div>


<div class="row" id="tweets">
  Loading..
</div>

<script>
  const tweetsElement = document.getElementById("tweets");
  // tweetsElement.innerHTML = 'Loading...'
  // var el1 = "<h1>Hi there 1</h1>"
  // var el2 = "<h1>Hi there 2</h1>"
  // var el3 = "<h1>Hi there 3</h1>"
  // tweetsElement.innerHTML = el1 + el2 + el3
  const xhr = new XMLHttpRequest();
  const method = "GET";
  const url = "/tweets";
  const responseType = "json";
  function handleDidLike(tweet_id, currentCount) {
      console.log(tweet_id, currentCount)
      currentCount++

  }
  function likeBtn(tweet) {
    return (
      "<button class='btn btn-primary btn-small' onclick=handleDidLike(" +
      tweet.id +
      "," +
      tweet.likes +
      ")>" + tweet.likes + " Likes</button>"
    );
  }
  function formatTweetElement(tweet) {
    var formattedTweet =
      "<div class='mb-4 col-12 col-md-10 mx-auto py-3 border rounded tweet' id='" +
      tweet.id +
      "'><p>" +
      tweet.content +
      "</p><div class='btn-group'>" +
      likeBtn(tweet) +
      "</div></div>";
    return formattedTweet;
  }
  xhr.responseType = responseType;
  xhr.open(method, url);
  xhr.onload = function () {
    const serverResponse = xhr.response;
    var listedItems = serverResponse.response;
    var finalTweetStr = "";
    for (var i = 0; i < listedItems.length; i++) {
      var tweetObj = listedItems[i];
      var currentItem = formatTweetElement(tweetObj);
      finalTweetStr += currentItem;
    }
    tweetsElement.innerHTML = finalTweetStr;
  };
  xhr.send();
</script>
{% endblock content %}
